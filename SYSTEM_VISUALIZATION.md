# ğŸ¨ MoE System Visualization

## Complete Pipeline: Training â†’ Inference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           TRAINING PHASE                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Raw PCAP Files
         â”‚
         â”œâ”€ Friday-WorkingHours-Afternoon-DDos.pcap_ISCX.csv
         â”œâ”€ Monday-WorkingHours.pcap_ISCX.csv
         â””â”€ ...
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Preprocessing â”‚  â† src/data/preprocess.py
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€ Feature Engineering (72 features for CICIDS)
            â”œâ”€ Feature Splitting (47 tabular + 25 temporal)
            â”œâ”€ Normalization (StandardScaler)
            â””â”€ Class Balancing (WeightedRandomSampler)
            â”‚
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         STAGE 1: PRETRAIN TABULAR          â”‚
    â”‚                                            â”‚
    â”‚  Input: Tabular features only (47)        â”‚
    â”‚  Model: FT-Transformer (~648k params)     â”‚
    â”‚  Loss: Masked Feature Modeling (MFM)      â”‚
    â”‚  Output: cicids_tabular_pretrained.pt     â”‚
    â”‚  Result: MFM Loss = 0.6526 (5 minutes)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         STAGE 2: TRAIN FULL MOE            â”‚
    â”‚                                            â”‚
    â”‚  Input: All features (47 tabular + 25 temp)â”‚
    â”‚  Model: MoE (733k params total)           â”‚
    â”‚    â”œâ”€ Tabular Expert (pretrained)         â”‚
    â”‚    â”œâ”€ Temporal Expert (1D CNN, 27k)       â”‚
    â”‚    â”œâ”€ Gating Network (42k)                â”‚
    â”‚    â””â”€ Classifier (MLP)                    â”‚
    â”‚  Loss: Weighted CrossEntropy              â”‚
    â”‚  Output: cicids_moe_best.pt               â”‚
    â”‚  Result: F1 = 98.3% (10 epochs)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      SAVED MODEL CHECKPOINT                â”‚
    â”‚                                            â”‚
    â”‚  models/weights/cicids_moe_best.pt        â”‚
    â”‚    - model_state_dict (all weights)       â”‚
    â”‚    - config (architecture settings)        â”‚
    â”‚    - feature_names (72 features)          â”‚
    â”‚    - class_names ['Normal', 'Attack']     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          INFERENCE PHASE                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Real-Time Network Traffic
         â”‚
         â”œâ”€ Flow 1: Normal web browsing
         â”œâ”€ Flow 2: DDoS attack (SYN flood)
         â”œâ”€ Flow 3: Normal SSH session
         â””â”€ Flow 4: Port scan
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       FEATURE EXTRACTION                   â”‚
    â”‚                                            â”‚
    â”‚  Monitoring Tool (e.g., Zeek, Suricata)   â”‚
    â”‚  Extracts: Flow Duration, Packet Counts,  â”‚
    â”‚            IAT Stats, Flags, etc.         â”‚
    â”‚                                            â”‚
    â”‚  âš ï¸ PROBLEM: Some features missing!       â”‚
    â”‚     - Zeek: 50/72 features                â”‚
    â”‚     - Suricata: 35/72 features            â”‚
    â”‚     - Lightweight IDS: 15/72 features     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       MoEInference.preprocess_features()   â”‚
    â”‚                                            â”‚
    â”‚  1. Handle Missing Features:              â”‚
    â”‚     - Strategy 'zero': Fill with 0        â”‚
    â”‚     - Strategy 'mean': Fill with mean     â”‚
    â”‚     - Strategy 'median': Fill with median â”‚
    â”‚                                            â”‚
    â”‚  2. Normalize:                             â”‚
    â”‚     - Use same scaler as training         â”‚
    â”‚                                            â”‚
    â”‚  3. Convert to tensor:                     â”‚
    â”‚     - Shape: [batch_size, 72]             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    MOE FORWARD PASS                         â”‚
    â”‚                                                             â”‚
    â”‚  Input: Normalized features [batch, 72]                    â”‚
    â”‚    â”‚                                                        â”‚
    â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
    â”‚    â”‚                      â”‚                         â”‚      â”‚
    â”‚    â†“                      â†“                         â†“      â”‚
    â”‚  Split Features     Split Features           Concatenate   â”‚
    â”‚  (47 tabular)       (25 temporal)            (all 72)      â”‚
    â”‚    â”‚                      â”‚                         â”‚      â”‚
    â”‚    â†“                      â†“                         â”‚      â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚      â”‚
    â”‚ â”‚ FT-Transformerâ”‚   â”‚   1D CNN    â”‚                â”‚      â”‚
    â”‚ â”‚  (648k params)â”‚   â”‚ (27k params) â”‚                â”‚      â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚      â”‚
    â”‚        â”‚                   â”‚                        â”‚      â”‚
    â”‚        â†“                   â†“                        â†“      â”‚
    â”‚   [128-dim]            [128-dim]            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚        â”‚                   â”‚                â”‚ Gating Networkâ”‚â”‚
    â”‚        â”‚                   â”‚                â”‚  (42k params) â”‚â”‚
    â”‚        â”‚                   â”‚                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
    â”‚        â”‚                   â”‚                       â”‚         â”‚
    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â†“         â”‚
    â”‚                   â”‚                       [w_tab, w_temp]    â”‚
    â”‚                   â†“                         (softmax)        â”‚
    â”‚            Weighted Combine                                  â”‚
    â”‚       output = w_tab * tab_emb + w_temp * temp_emb          â”‚
    â”‚                   â”‚                                          â”‚
    â”‚                   â†“                                          â”‚
    â”‚              [128-dim]                                       â”‚
    â”‚                   â”‚                                          â”‚
    â”‚                   â†“                                          â”‚
    â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
    â”‚            â”‚  Classifier  â”‚                                  â”‚
    â”‚            â”‚ (MLP: 128â†’2) â”‚                                  â”‚
    â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
    â”‚                   â”‚                                          â”‚
    â”‚                   â†“                                          â”‚
    â”‚              [logits: 2]                                     â”‚
    â”‚                   â”‚                                          â”‚
    â”‚                   â†“                                          â”‚
    â”‚              Softmax                                         â”‚
    â”‚                   â”‚                                          â”‚
    â”‚                   â†“                                          â”‚
    â”‚       [prob_normal, prob_attack]                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       MoEInference.predict() OUTPUT        â”‚
    â”‚                                            â”‚
    â”‚  {                                         â”‚
    â”‚    'prediction': 'Attack',                 â”‚
    â”‚    'confidence': 0.987,                    â”‚
    â”‚    'probabilities': {                      â”‚
    â”‚      'Normal': 0.013,                      â”‚
    â”‚      'Attack': 0.987                       â”‚
    â”‚    },                                      â”‚
    â”‚    'gating_weights': {                     â”‚
    â”‚      'Tabular Expert': 0.22,               â”‚
    â”‚      'Temporal Expert': 0.78               â”‚
    â”‚    }                                       â”‚
    â”‚  }                                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         INTERPRETATION                     â”‚
    â”‚                                            â”‚
    â”‚  Gating = 22% Tabular, 78% Temporal       â”‚
    â”‚                                            â”‚
    â”‚  â†’ Model is "Temporal-Dominant"           â”‚
    â”‚  â†’ Decision driven by timing patterns     â”‚
    â”‚  â†’ Likely attack: DDoS, Brute Force       â”‚
    â”‚                                            â”‚
    â”‚  Why?                                      â”‚
    â”‚  - Flow IAT Mean = 4.8ms (very low!)      â”‚
    â”‚  - SYN Flag Count = 250 (all SYN!)        â”‚
    â”‚  - Total Backward Packets = 0 (no reply)  â”‚
    â”‚                                            â”‚
    â”‚  â†’ Classic SYN flood signature            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Missing Feature Handling Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCENARIO: LIMITED MONITORING                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input: Only 10 features available (86% missing!)

  Feature Set (10/72 present):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âœ“ Flow Duration: 1200             â”‚
  â”‚ âœ“ Total Fwd Packets: 250          â”‚
  â”‚ âœ“ Flow IAT Mean: 4.8              â”‚
  â”‚ âœ“ SYN Flag Count: 250             â”‚
  â”‚ âœ“ ACK Flag Count: 0               â”‚
  â”‚ âœ“ Destination Port: 80            â”‚
  â”‚ âœ“ Total Backward Packets: 0       â”‚
  â”‚ âœ“ Flow Packets/s: 208.3           â”‚
  â”‚ âœ“ Flow IAT Std: 2.1               â”‚
  â”‚ âœ“ Fwd Packets/s: 208.3            â”‚
  â”‚                                   â”‚
  â”‚ âœ— Total Length of Fwd Packets     â”‚
  â”‚ âœ— Total Length of Bwd Packets     â”‚
  â”‚ âœ— Fwd Packet Length Mean          â”‚
  â”‚ âœ— ... (58 more features missing)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Missing Feature Handler                 â”‚
  â”‚                                          â”‚
  â”‚  Strategy: 'zero' (default)              â”‚
  â”‚                                          â”‚
  â”‚  For each missing feature:               â”‚
  â”‚    feature_value = 0.0                   â”‚
  â”‚                                          â”‚
  â”‚  Alternative strategies:                 â”‚
  â”‚    'mean': use training mean             â”‚
  â”‚    'median': use training median         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Complete Feature Vector (72 features)   â”‚
  â”‚                                          â”‚
  â”‚  [1200, 250, 4.8, 250, 0, 80, 0, 208.3,  â”‚
  â”‚   2.1, 208.3, 0, 0, 0, 0, ..., 0]        â”‚
  â”‚                                          â”‚
  â”‚  (10 real values + 62 zeros)             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚         FEATURE SPLITTING                â”‚
  â”‚                                          â”‚
  â”‚  Tabular (47):  [1200, 250, 80, ...]     â”‚
  â”‚    â†’ 5 real + 42 zeros                   â”‚
  â”‚                                          â”‚
  â”‚  Temporal (25): [4.8, 2.1, 208.3, ...]   â”‚
  â”‚    â†’ 5 real + 20 zeros                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                        â”‚
         â†“                        â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tabular    â”‚          â”‚ Temporal   â”‚
  â”‚ Expert     â”‚          â”‚ Expert     â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â†“                       â†“
    [128-dim]               [128-dim]
    (weak signal)           (strong signal!)
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Gating     â”‚
           â”‚   Network    â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
        [Tabular: 0.22, Temporal: 0.78]
                  â”‚
                  â†“
        ğŸ¯ MODEL ADAPTS AUTOMATICALLY!
           - Temporal features have signal
           - Tabular features mostly zeros
           - Gating shifts weight to Temporal Expert

  Result:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Prediction: Attack                      â”‚
  â”‚  Confidence: 96.5%                       â”‚
  â”‚  Gating: 78% Temporal (adapted!)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ’¡ Key Insight:
     Even with 86% missing features, the model still:
     âœ“ Detects the attack (SYN flood)
     âœ“ High confidence (96.5%)
     âœ“ Adapts gating weights to available features
```

---

## Gating Network Decision Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HOW GATING NETWORK DECIDES                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: Normal Web Traffic
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Flow Features:
    Flow Duration: 5234ms (normal)
    Total Fwd Packets: 3 (small)
    Flow IAT Mean: 1046ms (typical HTTP)
    SYN/ACK Flags: 1/4 (proper handshake)

  Expert Outputs:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Tabular Expert      â”‚  â”‚  Temporal Expert     â”‚
    â”‚                      â”‚  â”‚                      â”‚
    â”‚  "Packet counts OK"  â”‚  â”‚  "Timing normal"     â”‚
    â”‚  "Flags normal"      â”‚  â”‚  "IAT variance low"  â”‚
    â”‚  "Port = 80 (HTTP)"  â”‚  â”‚  "No bursts"         â”‚
    â”‚                      â”‚  â”‚                      â”‚
    â”‚  Embedding: [...]    â”‚  â”‚  Embedding: [...]    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Gating Input: Concatenate both embeddings [256-dim]

  Gating Network Decision:
    Input â†’ FC(256â†’128) â†’ ReLU â†’ FC(128â†’64) â†’ ReLU â†’ FC(64â†’2) â†’ Softmax
    
    Output: [0.52, 0.48]
    
    â†’ Balanced! Both experts contribute equally
    â†’ Both tabular and temporal patterns are normal

  Final Prediction: Normal (Confidence: 95%)


Scenario 2: DDoS SYN Flood Attack
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Flow Features:
    Flow Duration: 1200ms (very short)
    Total Fwd Packets: 250 (huge!)
    Flow IAT Mean: 4.8ms (extremely low - automated tool!)
    SYN Flag Count: 250 (all SYN, no ACK - red flag!)
    Total Backward Packets: 0 (server not responding)

  Expert Outputs:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Tabular Expert      â”‚  â”‚  Temporal Expert     â”‚
    â”‚                      â”‚  â”‚                      â”‚
    â”‚  "High SYN count"    â”‚  â”‚  "IAT = 4.8ms!!!"    â”‚
    â”‚  "No backward pkts"  â”‚  â”‚  "Perfect timing"    â”‚
    â”‚  "Port = 80"         â”‚  â”‚  "Bot-like behavior" â”‚
    â”‚                      â”‚  â”‚                      â”‚
    â”‚  Embedding: [...]    â”‚  â”‚  Embedding: [...]    â”‚
    â”‚  (moderate signal)   â”‚  â”‚  (STRONG signal!)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Gating Network Decision:
    Input â†’ FC(256â†’128) â†’ ReLU â†’ FC(128â†’64) â†’ ReLU â†’ FC(64â†’2) â†’ Softmax
    
    Output: [0.22, 0.78]
    
    â†’ Temporal-Dominant!
    â†’ The 4.8ms IAT is the smoking gun
    â†’ Automated attack tool signature

  Final Prediction: Attack (Confidence: 98.7%)


Scenario 3: Port Scan
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Flow Features:
    Flow Duration: 100ms (very short)
    Total Fwd Packets: 1 (single SYN)
    Flow IAT Mean: 0 (single packet)
    SYN Flag Count: 1
    Destination Port: 22 (SSH)

  Expert Outputs:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Tabular Expert      â”‚  â”‚  Temporal Expert     â”‚
    â”‚                      â”‚  â”‚                      â”‚
    â”‚  "Unusual port combo"â”‚  â”‚  "Single packet"     â”‚
    â”‚  "No connection est."â”‚  â”‚  "No timing info"    â”‚
    â”‚  "SYN without ACK"   â”‚  â”‚  "IAT = 0"           â”‚
    â”‚                      â”‚  â”‚                      â”‚
    â”‚  Embedding: [...]    â”‚  â”‚  Embedding: [...]    â”‚
    â”‚  (STRONG signal!)    â”‚  â”‚  (weak signal)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Gating Network Decision:
    Output: [0.65, 0.35]
    
    â†’ Tabular-Dominant!
    â†’ Port/flag patterns are more informative
    â†’ Not enough timing data

  Final Prediction: Attack (Confidence: 92%)
```

---

## Performance Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL PERFORMANCE COMPARISON                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CICIDS Dataset Results:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  XGBoost:           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  99.8%         â”‚
  â”‚                                                                  â”‚
  â”‚  MoE (Ours):        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘    98.3%         â”‚
  â”‚                                                                  â”‚
  â”‚  FT-Transformer:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘    96.4%         â”‚
  â”‚                                                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               0%                50%               100%
                          F1 Score

  Trade-offs:

    XGBoost:
      âœ“ Highest accuracy (99.8%)
      âœ“ Fast training
      âœ— Low interpretability (just feature importance)
      âœ— Doesn't model expert specialization

    MoE (Ours):
      âœ“ High interpretability (gating weights per sample!)
      âœ“ Models expert specialization (tabular vs temporal)
      âœ“ Robust to missing features
      âœ— Slightly lower accuracy (-1.5% vs XGBoost)

    FT-Transformer:
      âœ“ Medium interpretability (attention weights)
      âœ— Lower accuracy (-1.9% vs MoE)
      âœ— Not specialized for temporal patterns


Missing Feature Robustness:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  100% features:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  98.3%         â”‚
  â”‚                                                                  â”‚
  â”‚  90% features:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  97.7%         â”‚
  â”‚                                                                  â”‚
  â”‚  80% features:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  96.8%         â”‚
  â”‚                                                                  â”‚
  â”‚  50% features:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  91.2%         â”‚
  â”‚                                                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               0%                50%               100%
                          F1 Score

  Key Insight: With only 50% of features, still achieves 91.2% F1!


Inference Throughput:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                                  â”‚
  â”‚  CPU (single):      â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  434 samples/s   â”‚
  â”‚                                                                  â”‚
  â”‚  CPU (batch=32):    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  1,024 samples/s  â”‚
  â”‚                                                                  â”‚
  â”‚  GPU (batch=256):   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  2,560 samples/s  â”‚
  â”‚                                                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               0            1,000          2,000         3,000
                       Samples per Second

  Real-World Implication:
    - Small network (1,000 flows/sec): CPU is enough
    - Medium network (2,000 flows/sec): GPU batch processing
    - Large network (10,000+ flows/sec): Distributed GPU cluster
```

---

## File Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PROJECT FILE STRUCTURE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CORE IMPLEMENTATION FILES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  src/models/temporal_expert.py (370 lines)                         â”‚
â”‚    â””â”€ TemporalExpert (1D CNN architecture)                         â”‚
â”‚                                                                     â”‚
â”‚  src/models/gating_network.py (380 lines)                          â”‚
â”‚    â””â”€ GatingNetwork (MLP + softmax)                                â”‚
â”‚                                                                     â”‚
â”‚  src/models/moe_model.py (540 lines)                               â”‚
â”‚    â”œâ”€ MixtureOfExperts (main wrapper)                              â”‚
â”‚    â””â”€ load_moe_model() (helper function)                           â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€ DEPENDS ON:                                              â”‚
â”‚              - temporal_expert.py                                   â”‚
â”‚              - gating_network.py                                    â”‚
â”‚              - ft_transformer.py (Tabular Expert)                   â”‚
â”‚                                                                     â”‚
â”‚  src/data/feature_config.py (280 lines)                            â”‚
â”‚    â”œâ”€ CICIDS_TEMPORAL_INDICES                                      â”‚
â”‚    â”œâ”€ UNSW_TEMPORAL_INDICES                                        â”‚
â”‚    â””â”€ get_feature_split()                                          â”‚
â”‚                                                                     â”‚
â”‚  src/data/preprocess.py (modified)                                 â”‚
â”‚    â””â”€ Added feature splitting logic                                â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€ DEPENDS ON:                                              â”‚
â”‚              - feature_config.py                                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TRAINING FILES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  src/models/train_moe.py (580 lines)                               â”‚
â”‚    â”œâ”€ pretrain_tabular_expert() (Stage 1)                          â”‚
â”‚    â”œâ”€ train_moe() (Stage 2)                                        â”‚
â”‚    â””â”€ load_moe_dataset()                                           â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€ DEPENDS ON:                                              â”‚
â”‚              - moe_model.py                                         â”‚
â”‚              - feature_config.py                                    â”‚
â”‚              - preprocess.py                                        â”‚
â”‚                                                                     â”‚
â”‚  Usage:                                                             â”‚
â”‚    python -m src.models.train_moe --stage pretrain                 â”‚
â”‚    python -m src.models.train_moe --stage train                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INFERENCE FILES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  src/serving/inference.py (800 lines) â† NEW!                       â”‚
â”‚    â”œâ”€ MoEInference (main inference class)                          â”‚
â”‚    â”œâ”€ predict() (single sample)                                    â”‚
â”‚    â”œâ”€ predict_batch() (batch processing)                           â”‚
â”‚    â”œâ”€ preprocess_features() (missing feature handling)             â”‚
â”‚    â””â”€ analyze_prediction() (interpretation)                        â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€ DEPENDS ON:                                              â”‚
â”‚              - moe_model.py                                         â”‚
â”‚              - feature_config.py                                    â”‚
â”‚              - models/weights/cicids_moe_best.pt (checkpoint)       â”‚
â”‚                                                                     â”‚
â”‚  Usage:                                                             â”‚
â”‚    from src.serving.inference import MoEInference                  â”‚
â”‚    model = MoEInference('CICIDS', 'models/weights/cicids_moe.pt')  â”‚
â”‚    result = model.predict(features)                                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ANALYSIS FILES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  src/models/analyze_gating.py (420 lines)                          â”‚
â”‚    â”œâ”€ extract_gating_weights()                                     â”‚
â”‚    â”œâ”€ analyze_by_attack_type()                                     â”‚
â”‚    â””â”€ visualize_gating_by_attack()                                 â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€ DEPENDS ON:                                              â”‚
â”‚              - moe_model.py                                         â”‚
â”‚              - preprocess.py                                        â”‚
â”‚                                                                     â”‚
â”‚  Usage:                                                             â”‚
â”‚    python -m src.models.analyze_gating                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TEST FILES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  test_inference.py (comprehensive demo) â† NEW!                     â”‚
â”‚    â”œâ”€ test_single_prediction()                                     â”‚
â”‚    â”œâ”€ test_missing_features()                                      â”‚
â”‚    â”œâ”€ test_batch_prediction()                                      â”‚
â”‚    â””â”€ test_different_missing_strategies()                          â”‚
â”‚         â”‚                                                           â”‚
â”‚         â””â”€ DEPENDS ON:                                              â”‚
â”‚              - src/serving/inference.py                             â”‚
â”‚                                                                     â”‚
â”‚  Usage:                                                             â”‚
â”‚    python test_inference.py                                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DOCUMENTATION FILES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  MOE_RESULTS.md (500+ lines)                                       â”‚
â”‚    - Training results, confusion matrices, architecture overview   â”‚
â”‚                                                                     â”‚
â”‚  MoE_CROSS_DATASET_ANALYSIS.md (400+ lines)                        â”‚
â”‚    - CICIDS vs UNSW comparison, gating behavior analysis           â”‚
â”‚                                                                     â”‚
â”‚  MOE_ARCHITECTURE_CODE_GUIDE.md (extensive)                        â”‚
â”‚    - Code snippets, forward pass walkthrough, technical details    â”‚
â”‚                                                                     â”‚
â”‚  INFERENCE_AND_MISSING_FEATURES_GUIDE.md (comprehensive) â† NEW!    â”‚
â”‚    - Production deployment, missing feature experiments            â”‚
â”‚                                                                     â”‚
â”‚  QUICK_START_INFERENCE.md (quick reference) â† NEW!                 â”‚
â”‚    - Quick start examples, FAQ, deployment patterns                â”‚
â”‚                                                                     â”‚
â”‚  COMPLETE_PROJECT_SUMMARY.md (this summary) â† NEW!                 â”‚
â”‚    - Complete project overview, all components listed              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATA FLOW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚  Raw Data (data/raw/*.csv)                                         â”‚
â”‚        â†“                                                            â”‚
â”‚  preprocess.py â†’ Processed Data (data/processed/)                  â”‚
â”‚        â†“                                                            â”‚
â”‚  train_moe.py â†’ Model Checkpoint (models/weights/*.pt)             â”‚
â”‚        â†“                                                            â”‚
â”‚  inference.py â†’ Predictions (Real-time)                            â”‚
â”‚        â†“                                                            â”‚
â”‚  Production API/Streaming â†’ Alerts                                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ‰ You now have a complete visual understanding of the entire MoE system!**

**Next:** Run `python test_inference.py` to see everything in action! ğŸš€
